<?xml version="1.0" encoding="utf-8"?>
<TcPlcObject Version="1.1.0.1" ProductVersion="3.1.4024.13">
  <POU Name="FB_FaultDetection" Id="{8cfa4647-2d03-40bc-9cc1-058812bd946e}" SpecialFunc="None">
    <Declaration><![CDATA[FUNCTION_BLOCK FB_FaultDetection
VAR_INPUT
    Sensor1 : BOOL;          (* Sensor 1 input *)
    Sensor2 : BOOL;          (* Sensor 2 input *)
    Sensor3 : BOOL;          (* Sensor 3 input *)
END_VAR
VAR_OUTPUT
    FaultCondition : BOOL;   (* Flag to indicate fault detection *)
END_VAR
VAR
    FaultLogged : BOOL;      (* Flag to ensure fault is logged once *)
    FaultMessage : STRING;   (* Variable to store the fault message *)
END_VAR
VAR_OUTPUT
    FaultSignal : BOOL;      (* Output to indicate fault condition *)
END_VAR
VAR_INPUT
    ResetFault : BOOL;       (* Input to reset the fault condition *)
END_VAR
]]></Declaration>
    <Implementation>
      <ST><![CDATA[

(* Fault Detection Routine *)
IF NOT Sensor1 THEN
    FaultCondition := TRUE;
    FaultMessage := 'Fault: Sensor 1 is malfunctioning.';
ELSIF NOT Sensor2 THEN
    FaultCondition := TRUE;
    FaultMessage := 'Fault: Sensor 2 is malfunctioning.';
ELSIF NOT Sensor3 THEN
    FaultCondition := TRUE;
    FaultMessage := 'Fault: Sensor 3 is malfunctioning.';
ELSE
    FaultCondition := FALSE;
END_IF

(* Logging Fault Once *)
IF FaultCondition AND NOT FaultLogged THEN
    FaultLogged := TRUE;  (* Log the fault once *)
    FaultSignal := TRUE;  (* Activate FaultSignal *)
    (* You can use a logger function here to store the message if needed *)
END_IF

(* Reset Fault Logic *)
IF ResetFault THEN
    FaultCondition := FALSE;
    FaultLogged := FALSE; (* Reset the fault logged flag *)
    FaultMessage := '';    (* Clear the fault message *)
    FaultSignal := FALSE; (* Deactivate FaultSignal *)
END_IF

(* Additional Diagnostic Messages or Outputs *)
IF FaultCondition THEN
    (* Display or store the FaultMessage *)
    (* Example: You can send the message to an HMI or log file here *)
    (* HMI_Display(FaultMessage); *)
ELSE
    FaultMessage := 'No faults detected.';
END_IF
]]></ST>
    </Implementation>
    <LineIds Name="FB_FaultDetection">
      <LineId Id="19" Count="0" />
      <LineId Id="58" Count="0" />
      <LineId Id="21" Count="36" />
      <LineId Id="9" Count="0" />
    </LineIds>
  </POU>
</TcPlcObject>